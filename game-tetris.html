<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyber Defense: DDoS Protocol</title>
    <meta name="theme-color" content="#0d0d15">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <style>

        /* ================= –¢–û–ü-–ë–ê–† ================= */
.top-bar {
    width: 100%;
    background-color: #050911; /* —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω */
    color:  #00BCD4;           /* –±–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
    font-size: 25px;
    font-weight: 500;
    padding: 25px 0;
    text-align:left;
    position: fixed;          /* —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Å–≤–µ—Ä—Ö—É */
    top: 0;
    left: 0;
    z-index: 10;            /* —á—Ç–æ–±—ã –±—ã–ª–æ –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ */
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}

html, body {
  height: 100%;
}
/* —á—Ç–æ–±—ã –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –ø—Ä—è—Ç–∞–ª—Å—è –ø–æ–¥ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ç–æ–ø-–±–∞—Ä–æ–º */
body {
  display: flex;
  flex-direction: column;
}

main {
  flex: 1;
}

.top-bar-container {
    max-width: 1200px; /* –º–æ–∂–Ω–æ –ø–æ–¥ —Ä–∞–∑–º–µ—Ä —Å–∞–π—Ç–∞ */
    margin: 0 auto;
    padding: 0 15px;
}

/* ===== –ë–£–†–ì–ï–† ===== */
.burger {
  position: fixed;
  top: 20px;
  right: 20px;
  width: 30px;
  cursor: pointer;
  z-index: 1001;
}

.burger span {
  display: block;
  height: 3px;
  background: #00BCD4;
  margin: 6px 0;
  transition: 0.3s;
}

/* ===== TOP BAR –° –ú–ï–ù–Æ ===== */
.top-bar-flex {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.top-bar-title {
   text-transform: uppercase;     /* –ö–ê–ü–° */
  font-size: 22px;               /* –±–æ–ª—å—à–µ */
  font-weight: 600;
  letter-spacing: 1.2px;         /* –∫–∞–∫ —É –≤–∫–ª–∞–¥–æ–∫ */
}

/* –º–µ–Ω—é —Å–ø—Ä–∞–≤–∞ */
.top-nav--bar {
  display: flex;
  gap: 25px;
}

.top-nav--bar a {
  font-size: 15px;
  color: #8FA3BF;
  text-decoration: none;
  text-transform: uppercase;
  letter-spacing: 1px;
  position: relative;
}

.top-nav--bar a::after {
  content: '';
  position: absolute;
  left: 0;
  bottom: -4px;
  width: 0;
  height: 2px;
  background: #00BCD4;
  transition: 0.3s;
}

.top-nav--bar a:hover {
  color: #EAF2FF;
}

.top-nav--bar a:hover::after {
  width: 100%;
}

/* üì± –¢–ï–õ–ï–§–û–ù ‚Äî –¢–û–õ–¨–ö–û –¢–ï–ö–°–¢ */
@media (max-width: 768px) {
  .top-nav--bar {
    display: none;
  }
}

/* === –°–∫—Ä—ã–≤–∞–µ–º –±—É—Ä–≥–µ—Ä-–º–µ–Ω—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞ –ü–ö === */
.burger-menu,
.burger-overlay {
  display: none;
}

/* === –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±—É—Ä–≥–µ—Ä –∏ overlay —Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö === */
@media (min-width: 1024px) {
  .burger {
    display: none; /* –∫–Ω–æ–ø–∫–∞ –±—É—Ä–≥–µ—Ä */
    z-index: 10000; /* —á—Ç–æ–±—ã –±—ã—Ç—å –Ω–∞–¥ —à–∞–ø–∫–æ–π */
  }

/* ===== –ú–ï–ù–Æ ===== */
.burger-menu {
  position: fixed;
  top: 0;
  right: -320px;
  width: 320px;
  height: 100%;
  background: #0B1220;
  padding: 80px 30px;
  display: flex;
  flex-direction: column;
  gap: 20px;
  transform: translateX(100%);
  transition: right 0.3s ease;
  z-index: 9999;
}

.burger-menu a {
  color: #EAF2FF;
  text-decoration: none;
  font-size: 18px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  padding-bottom: 10px;
}

.burger-menu.active {
    transform: translateX(0);
  right: 0;
}

/* –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ */
.burger-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  display: none;
  z-index: 9998;
}

.burger-overlay.active {
  display: block;
}
}


        /* --- CSS (–°–¢–ò–õ–ò) --- */
        :root {
            --bg-color: #050510;
            --grid-color: rgba(0, 255, 255, 0.1);
            --neon-blue: #00f3ff;
            --neon-purple: #bc13fe;
            --neon-green: #0aff0a;
            --danger-red: #ff003c;
            --hud-bg: rgba(16, 20, 30, 0.85);
            --font-main: 'Courier New', Courier, monospace;
        }

        * {
            box-sizing: border-box;
            touch-action: manipulation; /* –û—Ç–∫–ª—é—á–∞–µ—Ç –∑—É–º –ø–æ –¥–≤–æ–π–Ω–æ–º—É —Ç–∞–ø—É */
        }

        body {
            background-color: var(--bg-color);
            color: var(--neon-blue);
            font-family: var(--font-main);
            margin: 70px;
            padding: 0;
            height: 100vh;
            overflow-y: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: 
                linear-gradient(rgba(0, 20, 0, 0.9), rgba(0, 10, 20, 0.95)),
                url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCI+CjxwYXRoIGQ9Ik0wIDBoNDB2NDBIMHoiIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiYSgwLCAyNTUsIDI1NSwgMC4wNSkiIHN0cm9rZS13aWR0aD0iMSIvPgo8L3N2Zz4=');
        }

        .app-container {
            width: 100%;
            max-width: 800px;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 10px;
        }

        /* --- Header --- */
        .cyber-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--neon-purple);
            padding-bottom: 10px;
            margin-bottom: 15px;
            background: linear-gradient(90deg, rgba(188,19,254,0.1) 0%, rgba(0,0,0,0) 100%);
        }

        .logo-area {
            display: flex;
            flex-direction: column;
        }

        .uni-logo {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--neon-green);
            text-shadow: 0 0 5px var(--neon-green);
        }

        .uni-sub {
            font-size: 0.6rem;
            color: #fff;
            opacity: 0.8;
        }

        .blink {
            animation: blinker 1.5s linear infinite;
            color: var(--neon-green);
        }

        @keyframes blinker {
            50% { opacity: 0; }
        }

        /* --- Game Wrapper --- */
        .game-wrapper {
            display: flex;
            flex: 1;
            justify-content: center;
            gap: 15px;
            position: relative;
            overflow: hidden;
        }

        /* --- HUD Panels --- */
        .hud-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-width: 120px;
        }

        .hud-box {
            background: var(--hud-bg);
            border: 1px solid var(--neon-blue);
            padding: 10px;
            box-shadow: 0 0 10px rgba(0, 243, 255, 0.2);
            text-align: center;
        }

        .hud-box h3 {
            margin: 0 0 5px 0;
            font-size: 0.7rem;
            color: #fff;
            border-bottom: 1px dashed var(--neon-blue);
        }

        .hud-box div {
            font-size: 1.5rem;
            font-weight: bold;
            text-shadow: 0 0 5px var(--neon-blue);
        }

        .info-log {
            flex-grow: 1;
            text-align: left;
            font-size: 0.7rem;
            color: var(--neon-green);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #log-content {
            font-size: 0.65rem;
            opacity: 0.8;
            flex: 1;
            overflow: hidden;
        }

        /* --- Canvas & Overlay --- */
        .canvas-container {
            position: relative;
            border: 2px solid var(--neon-purple);
            box-shadow: 0 0 20px rgba(188, 19, 254, 0.4);
            background: rgba(0, 0, 0, 0.8);
            display: flex; /* Fixes canvas sizing issues */
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 5, 16, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            text-align: center;
        }

        .hidden {
            display: none !important;
        }

        .danger {
            color: var(--danger-red);
            text-shadow: 0 0 10px var(--danger-red);
        }

        .cyber-btn {
            background: transparent;
            border: 2px solid var(--neon-green);
            color: var(--neon-green);
            padding: 10px 20px;
            font-family: var(--font-main);
            font-size: 1rem;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .cyber-btn:hover {
            background: var(--neon-green);
            color: #000;
            box-shadow: 0 0 20px var(--neon-green);
        }

        /* Floating Text Effect */
        .policy-text {
            position: absolute;
            color: var(--neon-green);
            font-weight: bold;
            font-size: 1rem;
            text-shadow: 0 0 5px #fff;
            pointer-events: none;
            animation: floatUp 1s forwards;
            width: 100%;
            text-align: center;
            left: 0;
        }

        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }

        /* --- Mobile Controls --- */
        .mobile-controls {
            display: none;
            justify-content: space-between;
            padding: 10px 0;
            margin-top: 10px;
        }

        .d-pad {
            background: rgba(0, 243, 255, 0.1);
            border: 1px solid var(--neon-blue);
            color: var(--neon-blue);
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
            cursor: pointer;
        }

        .d-pad:active {
            background: var(--neon-blue);
            color: #000;
        }
        
        .big-btn {
            border-radius: 15px; 
        }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            .game-wrapper {
                flex-direction: column;
                align-items: center;
            }
            
            .hud-panel {
                flex-direction: row;
                width: 100%;
                justify-content: space-between;
                min-width: auto;
            }

            .left-panel { order: 1; }
            .canvas-container { order: 2; height: 55vh; width: auto; aspect-ratio: 240/400; } 
            .right-panel { display: none; } /* –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∞–≤—É—é –ø–∞–Ω–µ–ª—å –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ */
            
            .mobile-controls {
                display: flex;
                width: 100%;
                max-width: 350px;
                margin: 0 auto;
                order: 3;
            }
        }
        
    </style>
</head>
<body>

    <!-- –¢–û–ü-–ë–ê–† (—Ç–æ—Ç –∂–µ —Å–∞–º—ã–π) -->
<div class="top-bar">
  <div class="top-bar-container top-bar-flex">
    <div class="top-bar-title">
      –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ú—É–∑–µ–π –ö–∏–±–µ—Ä–∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤
    </div>

    <nav class="top-nav top-nav--bar">
      <a href="library.html">–í–∏–¥–µ–æ–±–∏–±–ª–∏–æ—Ç–µ–∫–∞</a>
      <a href="games.html">–ö–∏–±–µ—Ä–ø–æ–ª–∏–≥–æ–Ω</a>
      <a href="index.html">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </nav>
  </div>
</div>


    <div class="app-container">
        <header class="cyber-header">
            <div class="logo-area">
                <div class="uni-logo">IGPS.EMERCOM</div>
                <div class="uni-sub">–°–ü–± –£–ù–ò–í–ï–†–°–ò–¢–ï–¢ –ì–ü–° –ú–ß–° –†–û–°–°–ò–ò</div>
            </div>
            <div class="status-indicator">
                SYSTEM: <span id="sys-status" class="blink">ONLINE</span>
            </div>
        </header>

        <main class="game-wrapper">
            
            <aside class="hud-panel left-panel">
                <div class="hud-box">
                    <h3>–£–ì–†–û–ó–ê (LEVEL)</h3>
                    <div id="level-display">1</div>
                </div>
                <div class="hud-box">
                    <h3>–§–ò–õ–¨–¢–† (LINES)</h3>
                    <div id="lines-display">0</div>
                </div>
                <div class="hud-box">
                    <h3>–ê–ü–¢–ê–ô–ú</h3>
                    <div id="time-display">00:00</div>
                </div>
            </aside>

            <div class="canvas-container">
                <div class="overlay" id="start-overlay">
                    <h1>DDoS DEFENSE</h1>
                    <p>–û–ü–ï–†–ê–¢–û–†, –°–ò–°–¢–ï–ú–ê –ü–û–î –£–ì–†–û–ó–û–ô.</p>
                    <p>–§–ò–õ–¨–¢–†–£–ô–¢–ï –ü–ê–ö–ï–¢–´.</p>
                    <button id="start-btn" class="cyber-btn">–ó–ê–ü–£–°–¢–ò–¢–¨ –ü–†–û–¢–û–ö–û–õ</button>
                </div>
                <div class="overlay hidden" id="game-over-overlay">
                    <h1 class="danger">SYSTEM FAILURE</h1>
                    <p>–ö–ê–ù–ê–õ –ü–ï–†–ï–ü–û–õ–ù–ï–ù</p>
                    <p>–†–ï–ó–£–õ–¨–¢–ê–¢: <span id="final-score">0</span></p>
                    <button id="restart-btn" class="cyber-btn">–ü–ï–†–ï–ó–ê–ì–†–£–ó–ò–¢–¨ –Ø–î–†–û</button>
                </div>
                
                <div id="floating-text-container"></div>
                
                <canvas id="tetris" width="240" height="400"></canvas>
            </div>

            <aside class="hud-panel right-panel">
                <div class="hud-box">
                    <h3>–í–•–û–î–Ø–©–ò–ô –ü–ê–ö–ï–¢</h3>
                    <canvas id="next-piece" width="80" height="80"></canvas>
                </div>
                <div class="hud-box info-log">
                    <h3>–õ–û–ì –°–û–ë–´–¢–ò–ô</h3>
                    <div id="log-content">
                        > Init sequence...<br>
                        > Waiting for packets...
                    </div>
                </div>
            </aside>
        </main>

        <div class="mobile-controls">
            <button class="d-pad" id="btn-left">‚óÄ</button>
            <button class="d-pad" id="btn-rotate">‚Üª</button>
            <button class="d-pad" id="btn-right">‚ñ∂</button>
            <button class="d-pad big-btn" id="btn-down">‚ñº</button>
        </div>
    </div>

    
    <script>
        /* --- JAVASCRIPT (–õ–û–ì–ò–ö–ê) --- */
        const canvas = document.getElementById('tetris');
        const context = canvas.getContext('2d');
        const nextCanvas = document.getElementById('next-piece');
        const nextContext = nextCanvas.getContext('2d');

        // Scale calculation
        context.scale(20, 20);
        nextContext.scale(20, 20);

        // UI Elements
        const uiLevel = document.getElementById('level-display');
        const uiLines = document.getElementById('lines-display');
        const uiTime = document.getElementById('time-display');
        const uiLog = document.getElementById('log-content');
        const overlayStart = document.getElementById('start-overlay');
        const overlayGameOver = document.getElementById('game-over-overlay');
        const uiFinalScore = document.getElementById('final-score');
        const floatingContainer = document.getElementById('floating-text-container');

        // Game State
        let dropCounter = 0;
        let dropInterval = 1000;
        let lastTime = 0;
        let gameRunning = false;
        let startTime = 0;
        let animationId = null;

        const player = {
            pos: { x: 0, y: 0 },
            matrix: null,
            score: 0,
            lines: 0,
            level: 1,
        };

        const colors = [
            null,
            '#bc13fe', // T
            '#0aff0a', // Z
            '#00f3ff', // J
            '#ffff00', // O
            '#00f3ff', // I
            '#bc13fe', // S
            '#ff003c', // L
            '#444455', // Noise
        ];

        /* --- Arena & Mechanics --- */
        function createMatrix(w, h) {
            const matrix = [];
            while (h--) {
                matrix.push(new Array(w).fill(0));
            }
            return matrix;
        }

        const arena = createMatrix(12, 20);

        function createPiece(type) {
            if (type === 'I') {
                return [
                    [0, 5, 0, 0],
                    [0, 5, 0, 0],
                    [0, 5, 0, 0],
                    [0, 5, 0, 0],
                ];
            } else if (type === 'L') {
                return [
                    [0, 7, 0],
                    [0, 7, 0],
                    [0, 7, 7],
                ];
            } else if (type === 'J') {
                return [
                    [0, 3, 0],
                    [0, 3, 0],
                    [3, 3, 0],
                ];
            } else if (type === 'O') {
                return [
                    [4, 4],
                    [4, 4],
                ];
            } else if (type === 'Z') {
                return [
                    [2, 2, 0],
                    [0, 2, 2],
                    [0, 0, 0],
                ];
            } else if (type === 'S') {
                return [
                    [0, 6, 6],
                    [6, 6, 0],
                    [0, 0, 0],
                ];
            } else if (type === 'T') {
                return [
                    [0, 1, 0],
                    [1, 1, 1],
                    [0, 0, 0],
                ];
            }
        }

        function drawBlock(ctx, x, y, colorValue) {
            ctx.fillStyle = colors[colorValue];
            ctx.fillRect(x, y, 1, 1);
            
            ctx.lineWidth = 0.05;
            ctx.strokeStyle = 'white';
            ctx.strokeRect(x, y, 1, 1);
            
            ctx.fillStyle = 'rgba(0,0,0,0.5)';
            ctx.fillRect(x + 0.3, y + 0.3, 0.4, 0.4);
        }

        function draw() {
            context.fillStyle = '#050510';
            context.fillRect(0, 0, canvas.width, canvas.height);
            drawMatrix(arena, {x: 0, y: 0}, context);
            drawMatrix(player.matrix, player.pos, context);
        }

        function drawMatrix(matrix, offset, ctx) {
            matrix.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value !== 0) {
                        drawBlock(ctx, x + offset.x, y + offset.y, value);
                    }
                });
            });
        }

        function drawNext() {
            nextContext.fillStyle = '#10141e';
            nextContext.fillRect(0, 0, nextCanvas.width, nextCanvas.height);
            if(nextPiece) {
                const offset = {
                    x: (4 - nextPiece[0].length) / 2,
                    y: (4 - nextPiece.length) / 2
                };
                drawMatrix(nextPiece, offset, nextContext);
            }
        }

        /* --- Game Logic --- */
        function collide(arena, player) {
            const m = player.matrix;
            const o = player.pos;
            for (let y = 0; y < m.length; ++y) {
                for (let x = 0; x < m[y].length; ++x) {
                    if (m[y][x] !== 0 &&
                       (arena[y + o.y] &&
                        arena[y + o.y][x + o.x]) !== 0) {
                        return true;
                    }
                }
            }
            return false;
        }

        function merge(arena, player) {
            player.matrix.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value !== 0) {
                        arena[y + player.pos.y][x + player.pos.x] = value;
                    }
                });
            });
        }

        function rotate(matrix, dir) {
            for (let y = 0; y < matrix.length; ++y) {
                for (let x = 0; x < y; ++x) {
                    [matrix[x][y], matrix[y][x]] = [matrix[y][x], matrix[x][y]];
                }
            }
            if (dir > 0) {
                matrix.forEach(row => row.reverse());
            } else {
                matrix.reverse();
            }
        }

        function playerDrop() {
            player.pos.y++;
            if (collide(arena, player)) {
                player.pos.y--;
                merge(arena, player);
                playerReset();
                arenaSweep();
                updateScore();
            }
            dropCounter = 0;
        }

        function playerMove(offset) {
            player.pos.x += offset;
            if (collide(arena, player)) {
                player.pos.x -= offset;
            }
        }

        function playerRotate(dir) {
            const pos = player.pos.x;
            let offset = 1;
            rotate(player.matrix, dir);
            while (collide(arena, player)) {
                player.pos.x += offset;
                offset = -(offset + (offset > 0 ? 1 : -1));
                if (offset > player.matrix[0].length) {
                    rotate(player.matrix, -dir);
                    player.pos.x = pos;
                    return;
                }
            }
        }

        let nextPiece = null;

        function playerReset() {
            const pieces = 'ILJOTSZ';
            if(nextPiece === null) {
                nextPiece = createPiece(pieces[pieces.length * Math.random() | 0]);
            }
            
            player.matrix = nextPiece;
            nextPiece = createPiece(pieces[pieces.length * Math.random() | 0]);
            drawNext();

            player.pos.y = 0;
            player.pos.x = (arena[0].length / 2 | 0) - (player.matrix[0].length / 2 | 0);
                           
            if (collide(arena, player)) {
                gameOver();
            }
            
            addLog("Incoming packet detected...");
        }

        function generateNoise(level) {
            const linesOfGarbage = Math.min(level + 1, 8);
            for (let y = 20 - linesOfGarbage; y < 20; y++) {
                for (let x = 0; x < 12; x++) {
                    if (Math.random() > 0.4) {
                        arena[y][x] = 8;
                    } else {
                        arena[y][x] = 0;
                    }
                }
            }
        }

        function arenaSweep() {
            let rowCount = 0;
            outer: for (let y = arena.length - 1; y > 0; --y) {
                for (let x = 0; x < arena[y].length; ++x) {
                    if (arena[y][x] === 0) {
                        continue outer;
                    }
                }

                const row = arena.splice(y, 1)[0].fill(0);
                arena.unshift(row);
                ++y;
                rowCount++;
                showFloatingText("POLICY APPLIED: FILTERED");
            }
            
            if (rowCount > 0) {
                player.lines += rowCount;
                player.score += rowCount * 10;
                
                if(Math.floor(player.lines / 5) + 1 > player.level) {
                    player.level++;
                    dropInterval = Math.max(100, 1000 - (player.level * 100));
                    addLog(`THREAT LEVEL INCREASED: ${player.level}`);
                }
                
                addLog(`> Packets filtered: ${rowCount}`);
            }
        }

        function showFloatingText(text) {
            const div = document.createElement('div');
            div.className = 'policy-text';
            div.innerText = text;
            div.style.top = '40%';
            floatingContainer.appendChild(div);
            setTimeout(() => div.remove(), 1000);
        }

        function addLog(msg) {
            const span = document.createElement('div');
            span.innerText = `> ${msg}`;
            uiLog.prepend(span);
            if(uiLog.children.length > 5) uiLog.lastChild.remove();
        }

        function updateScore() {
            uiLevel.innerText = player.level;
            uiLines.innerText = player.lines;
        }

        function updateTime() {
            const now = Date.now();
            const diff = Math.floor((now - startTime) / 1000);
            const m = Math.floor(diff / 60).toString().padStart(2, '0');
            const s = (diff % 60).toString().padStart(2, '0');
            uiTime.innerText = `${m}:${s}`;
        }

        function gameOver() {
            gameRunning = false;
            cancelAnimationFrame(animationId);
            overlayGameOver.classList.remove('hidden');
            uiFinalScore.innerText = `${player.lines} LINES`;
            document.getElementById('sys-status').innerText = 'OFFLINE';
            document.getElementById('sys-status').style.color = 'red';
        }

        function startLevel() {
            for (let y = 0; y < arena.length; ++y) {
                for (let x = 0; x < arena[y].length; ++x) {
                    arena[y][x] = 0;
                }
            }
            
            player.score = 0;
            player.lines = 0;
            player.level = 1;
            dropInterval = 1000;
            startTime = Date.now();
            nextPiece = null;
            
            generateNoise(player.level);
            playerReset();
            updateScore();
            gameRunning = true;
            overlayStart.style.display = 'none';
            overlayGameOver.classList.add('hidden');
            document.getElementById('sys-status').innerText = 'ONLINE';
            document.getElementById('sys-status').style.color = '#0aff0a';
            
            addLog("System started. Firewall Active.");
            update();
        }

        function update(time = 0) {
            if(!gameRunning) return;

            const deltaTime = time - lastTime;
            lastTime = time;

            dropCounter += deltaTime;
            if (dropCounter > dropInterval) {
                playerDrop();
            }

            draw();
            updateTime();
            animationId = requestAnimationFrame(update);
        }

        /* --- Inputs --- */
        document.addEventListener('keydown', event => {
            if(!gameRunning) return;
            if (event.keyCode === 37) playerMove(-1);
            else if (event.keyCode === 39) playerMove(1);
            else if (event.keyCode === 40) playerDrop();
            else if (event.keyCode === 81) playerRotate(-1);
            else if (event.keyCode === 87 || event.keyCode === 38) playerRotate(1);
        });

        document.getElementById('start-btn').addEventListener('click', startLevel);
        document.getElementById('restart-btn').addEventListener('click', startLevel);

        document.getElementById('btn-left').addEventListener('click', () => playerMove(-1));
        document.getElementById('btn-right').addEventListener('click', () => playerMove(1));
        document.getElementById('btn-rotate').addEventListener('click', () => playerRotate(1));
        document.getElementById('btn-down').addEventListener('click', () => playerDrop());

        const btns = document.querySelectorAll('.d-pad');
        btns.forEach(btn => {
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                btn.click();
            });
        });
    </script>
</body>
</html>


